(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[901],{75866:function(t,n,i){!function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var n,i,o,e=function(t,n){var i=t.value;return t.isInPixels?i/n:i};function r(t){if("string"==typeof t&&-1!==t.indexOf("%"))return{value:parseFloat(t)/100,isInPixels:!1};var n=t?parseFloat(t):0;return{value:n,isInPixels:n>0}}n=L.Marker.prototype._initIcon,i=L.Marker.prototype._setPos,o="msTransform"===L.DomUtil.TRANSFORM,L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){n.call(this)},_setPos:function(t){i.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,o?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),t.Symbol=t.Symbol||{},t.Symbol.Dash=t.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function(n,i,o,e,r){var a=this.options;if(a.pixelSize<=1)return t.polyline([n.latLng,n.latLng],a.pathOptions);var s=o.project(n.latLng),l=-(n.heading-90)*(Math.PI/180),p=t.point(s.x+a.pixelSize*Math.cos(l+Math.PI)/2,s.y+a.pixelSize*Math.sin(l)/2),u=s.add(s.subtract(p));return t.polyline([o.unproject(p),o.unproject(u)],a.pathOptions)}}),t.Symbol.dash=function(n){return new t.Symbol.Dash(n)},t.Symbol.ArrowHead=t.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(n){t.Util.setOptions(this,n),this.options.pathOptions.clickable=!1},buildSymbol:function(n,i,o,e,r){return this.options.polygon?t.polygon(this._buildArrowPath(n,o),this.options.pathOptions):t.polyline(this._buildArrowPath(n,o),this.options.pathOptions)},_buildArrowPath:function(n,i){var o=Math.PI/180,e=i.project(n.latLng),r=-(n.heading-90)*o,a=this.options.headAngle/2*o,s=r+a,l=r-a,p=t.point(e.x-this.options.pixelSize*Math.cos(s),e.y+this.options.pixelSize*Math.sin(s)),u=t.point(e.x-this.options.pixelSize*Math.cos(l),e.y+this.options.pixelSize*Math.sin(l));return[i.unproject(p),n.latLng,i.unproject(u)]}}),t.Symbol.arrowHead=function(n){return new t.Symbol.ArrowHead(n)},t.Symbol.Marker=t.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(n){t.Util.setOptions(this,n),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(n,i,o,e,r){return this.options.rotate&&(this.options.markerOptions.rotationAngle=n.heading+(this.options.angleCorrection||0)),t.marker(n.latLng,this.options.markerOptions)}}),t.Symbol.marker=function(n){return new t.Symbol.Marker(n)};var a=function(n){var i;return Array.isArray(n)&&((i=n[0])instanceof t.LatLng||Array.isArray(i)&&2===i.length&&"number"==typeof i[0])};t.PolylineDecorator=t.FeatureGroup.extend({options:{patterns:[]},initialize:function(n,i){t.FeatureGroup.prototype.initialize.call(this),t.Util.setOptions(this,i),this._map=null,this._paths=this._initPaths(n),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(n,i){var o=this;return a(n)?[i?n.concat([n[0]]):n]:n instanceof t.Polyline?this._initPaths(n.getLatLngs(),n instanceof t.Polygon):Array.isArray(n)?n.reduce(function(t,n){return t.concat(o._initPaths(n,i))},[]):[]},_initPatterns:function(t){return t.map(this._parsePatternDef)},setPatterns:function(t){this.options.patterns=t,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(t){this._paths=this._initPaths(t),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(t,n){return{symbolFactory:t.symbol,offset:r(t.offset),endOffset:r(t.endOffset),repeat:r(t.repeat)}},onAdd:function(t){this._map=t,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(n){this._map.off("moveend",this.redraw,this),this._map=null,t.FeatureGroup.prototype.onRemove.call(this,n)},_initBounds:function(){var n=this._paths.reduce(function(t,n){return t.concat(n)},[]);return t.latLngBounds(n)},getBounds:function(){return this._bounds},_buildSymbols:function(t,n,i){var o=this;return i.map(function(e,r){return n.buildSymbol(e,t,o._map,r,i.length)})},_getDirectionPoints:function(n,i){var o=this;return n.length<2?[]:(function(t,n){var i=t.reduce(function(t,n,i,o){var e;if(i>0&&(e=o[i-1],n.x!==e.x||n.y!==e.y)){var r,a,s=o[i-1],l=t.length>0?t[t.length-1].distB:0,p=Math.sqrt((r=n.x-s.x)*r+(a=n.y-s.y)*a);t.push({a:s,b:n,distA:l,distB:l+p,heading:(180*Math.atan2(n.y-s.y,n.x-s.x)/Math.PI+90+360)%360})}return t},[]),o=i.length;if(0===o)return[];var r=i[o-1].distB,a=e(n.offset,r),s=e(n.endOffset,r),l=e(n.repeat,r),p=r*l,u=a>0?r*a:0,h=s>0?r*s:0,c=[],f=u;do c.push(f),f+=p;while(p>0&&f<r-h);var d=0,y=i[0];return c.map(function(t){for(;t>y.distB&&d<o-1;)y=i[++d];var n,e,r=(t-y.distA)/(y.distB-y.distA);return{pt:(n=y.a,(e=y.b).x!==n.x?{x:n.x+r*(e.x-n.x),y:n.y+r*(e.y-n.y)}:{x:n.x,y:n.y+(e.y-n.y)*r}),heading:y.heading}})})(n.map(function(t){return o._map.project(t)}),i).map(function(n){return{latLng:o._map.unproject(t.point(n.pt)),heading:n.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(n){var i=this,o=this._map.getBounds().pad(.1);return this._paths.map(function(e){var r=i._getDirectionPoints(e,n).filter(function(t){return o.contains(t.latLng)});return t.featureGroup(i._buildSymbols(e,n.symbolFactory,r))})},_draw:function(){var n=this;this._patterns.map(function(t){return n._getPatternLayers(t)}).forEach(function(i){n.addLayer(t.featureGroup(i))})}}),t.polylineDecorator=function(n,i){return new t.PolylineDecorator(n,i)}}(i(77691))},69901:function(t,n,i){"use strict";i.r(n);var o=i(57437),e=i(2265),r=i(77691),a=i.n(r);i(60966),i(75866);var s=i(17156);n.default=e.memo(t=>{let{data:n,selectedMarket:i,title:r,description:l}=t,p=(0,e.useRef)(null),u=(0,e.useRef)(null);(0,e.useEffect)(()=>(console.log("FlowMap component mounted or updated."),p.current||(console.log("Initializing Leaflet map for FlowMap..."),p.current=a().map("flow-map").setView([15.552727,48.516388],6),a().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(p.current)),()=>{console.log("FlowMap component unmounting. Cleaning up..."),p.current&&(p.current.remove(),p.current=null)}),[]);let h=(0,e.useCallback)(t=>{console.log("Creating flow arrows..."),u.current?u.current.clearLayers():u.current=a().layerGroup().addTo(p.current),t.forEach(t=>{let{source_lat:n,source_lng:o,target_lat:e,target_lng:r,weight:s}=t;if(c(n,o)&&c(e,r)){let l=a().polyline([[parseFloat(n),parseFloat(o)],[parseFloat(e),parseFloat(r)]],{color:i&&(t.source===i||t.target===i)?"#ff5722":"#2196f3",weight:Math.min(parseFloat(s)/10,5),opacity:i?t.source===i||t.target===i?1:.5:.7}),p=a().polylineDecorator(l,{patterns:[{offset:"100%",repeat:0,symbol:a().Symbol.arrowHead({pixelSize:10,polygon:!1,pathOptions:{stroke:!0,color:l.options.color}})}]});l.bindPopup("<strong>Flow from ".concat(t.source," to ").concat(t.target,"</strong><br>Weight: ").concat(s)),l.addTo(u.current),p.addTo(u.current)}else console.warn("Invalid coordinates:",t)})},[i]);(0,e.useEffect)(()=>{if(console.log("FlowMap data or selectedMarket updated:",{dataLength:null==n?void 0:n.length,selectedMarket:i}),p.current&&Array.isArray(n)&&n.length>0){let t=n.filter(t=>!i||t.source===i||t.target===i);console.log("Filtered flows:",t.length),h(t)}},[n,i,h]);let c=(t,n)=>{let i=parseFloat(t),o=parseFloat(n);return!isNaN(i)&&!isNaN(o)&&i>=-90&&i<=90&&o>=-180&&o<=180};return(0,o.jsxs)(s.Z,{className:"flow-map",children:[(0,o.jsx)("h3",{children:r}),(0,o.jsx)("p",{children:l}),(0,o.jsx)("div",{id:"flow-map",style:{height:"500px",width:"100%"}}),(!Array.isArray(n)||0===n.length)&&(0,o.jsx)("p",{children:"No flow data available"})]})})},60966:function(){}}]);